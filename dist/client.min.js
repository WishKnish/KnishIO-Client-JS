var KnishIO=function(e,t,s,n,l,r,i,a,o,u,c,h){"use strict";function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=d(s),m=d(l),y=d(r);class f{static toHex(e,t){const s=(e,t)=>{const s=t?["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"]:["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return s[Math.floor(e/16)]+s[e%16]},n=Object.assign({grouping:0,rowlength:0,uppercase:!1},t||{});let l="",r=0,i=0;for(let t=0;t<e.length&&(l+=s(e[t],n.uppercase),t!==e.length-1);++t)n.grouping>0&&++r===n.grouping&&(r=0,n.rowlength>0&&++i===n.rowlength?(i=0,l+="\n"):l+=" ");return l}static toUint8Array(e){let t=e.toLowerCase().replace(/\s/g,"");t.length%2==1&&(t="0"+t);let s=new Uint8Array(Math.floor(t.length/2)),n=-1;for(let e=0;e<t.length;++e){let l=t[e],r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"].indexOf(l);if(-1===r)throw Error("unexpected character");-1===n?n=16*r:(s[Math.floor(e/2)]=n+r,n=-1)}return s}}function g(e,t){const s=Math.ceil(e.length/t),n=new Array(s);for(let l=0,r=0;l<s;++l,r+=t)n[l]=e.substr(r,t);return n}function w(e=256,t="abcdef0123456789"){let s=new Uint8Array(e);return(window.crypto||window.msCrypto).getRandomValues(s),s=s.map((e=>t.charCodeAt(e%t.length))),String.fromCharCode.apply(null,s)}function k(e,t,s,n,l){if(n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~`!@#$%^&*()-_=+[{]}\\|;:'\",<.>/?¿¡",l=l||n,t>n.length||s>l.length)return console.warn("Can't convert",e,"to base",s,"greater than symbol table length. src-table:",n.length,"dest-table:",l.length),!1;let r=p.default(0);for(let s=0;s<e.length;s++)r=r.multiply(t).add(n.indexOf(e.charAt(s)));if(r.lesser(0))return 0;let i=r.mod(s),a=l.charAt(i),o=r.divide(s);for(;!o.equals(0);)i=o.mod(s),o=o.divide(s),a=l.charAt(i)+a;return a}function b(e){return n.encode(f.toUint8Array(e))}function _(e){return f.toHex(n.decode(e),{})}function $(e){return/^[A-F0-9]+$/i.test(e)}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});class x{constructor(e,t,s,n=null){this.modelType=e,this.modelId=t,this.meta=s,this.snapshotMolecule=n,this.createdAt=+new Date}static normalizeMeta(e){if("[object Object]"===Object.prototype.toString.call(e)){const t=[];for(const s in e)e.hasOwnProperty(s)&&null!==e[s]&&t.push({key:s,value:e[s]});return t}return e}static aggregateMeta(e){const t={};if("[object Array]"===Object.prototype.toString.call(e))for(let s of e)t[s.key]=s.value;return Object.keys(t).length>0?t:e}}class S{constructor(e=null,t=null,s=null,n=null,l=null,r=null,i=null,a=null,o=null,u=null,c=null){this.position=e,this.walletAddress=t,this.isotope=s,this.token=n,this.value=null!==l?String(l):null,this.batchId=r,this.metaType=i,this.metaId=a,this.meta=o?x.normalizeMeta(o):[],this.index=c,this.otsFragment=u,this.createdAt=String(+new Date)}static jsonToObject(e){const t=Object.assign(new S,JSON.parse(e)),s=Object.keys(new S);for(const e in t)t.hasOwnProperty(e)&&!s.includes(e)&&delete t[e];return t}static hashAtoms(e,s="base17"){const n=t.shake256.create(256),l=e.length,r=S.sortAtoms(e);for(const e of r){n.update(String(l));for(const t in e)if(e.hasOwnProperty(t)){if(["batchId","pubkey","characters"].includes(t)&&null===e[t])continue;if(["otsFragment","index"].includes(t))continue;if("meta"===t){e[t]=x.normalizeMeta(e[t]);for(const s of e[t])void 0!==s.value&&null!==s.value&&(n.update(String(s.key)),n.update(String(s.value)));continue}if(["position","walletAddress","isotope"].includes(t)){n.update(null===e[t]?"":String(e[t]));continue}null!==e[t]&&n.update(null===e[t]?"":String(e[t]))}}switch(s){case"hex":return n.hex();case"array":return n.array();default:return k(n.hex(),16,17,"0123456789abcdef","0123456789abcdefg").padStart(64,"0")}}static sortAtoms(e){const t=[...e];return t.sort(((e,t)=>e.index===t.index?0:e.index<t.index?-1:1)),t}}class M{constructor(e={}){this.$options=Object.assign({characters:"GMP"},e),this.$encoder=y.default(this[this.$options.characters]||this.GMP)}encode(e){return this.$encoder.encode(i.Buffer.from(e))}decode(e){return this.$encoder.decode(e)}get GMP(){return"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuv"}get BITCOIN(){return"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}get FLICKR(){return"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}get RIPPLE(){return"rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"}get IPFS(){return"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}}const W=10**18;class I{static val(e){return Math.abs(e*W)<1?0:e}static cmp(e,t,s=!1){const n=I.val(e)*W,l=I.val(t)*W;return Math.abs(n-l)<1?0:n>l?1:-1}static equal(e,t){return 0===I.cmp(e,t)}}class v{constructor(e=null){this.base=new M(e)}encrypt(e,t){return this.encode(o.seal(u.encode(JSON.stringify(e)),this.decode(t)))}decrypt(e,t,s){try{return JSON.parse(u.decode(o.open(this.decode(e),this.decode(s),this.decode(t))))}catch(e){return null}}generatePrivateKey(e){const s=t.shake256.create(8*a.box.secretKeyLength);return s.update(e),this.base.encode(i.Buffer.from(s.digest()))}generatePublicKey(e){const t=a.box.keyPair.fromSecretKey(this.decode(e));return this.encode(t.publicKey)}shortHash(e){const s=t.shake256.create(64);return s.update(e),this.base.encode(i.Buffer.from(s.digest()))}decode(e){return this.base.decode(e)}encode(e){return this.base.encode(e)}}function A(e=null,s=2048){if(console.info(`Crypto::generateSecret() - Computing new secret${e?" from existing seed":""}...`),e){const n=t.shake256.create(2*s);return n.update(e),n.hex()}return w(s)}function T(e){console.info("Crypto::bundle() - Computing wallet bundle from secret...");const s=t.shake256.create(256);return s.update(e),s.hex()}function C(){return w(64)}function q(e=64){return w(e,"abcdef0123456789")}function H(e,t,s=null){return new v(s).encrypt(e,t)}function O(e,t,s,n=null){return new v(n).decrypt(e,t,s)}function R(e,t=null){return new v(t).generatePrivateKey(e)}function K(e,t=null){return new v(t).generatePublicKey(e)}function E(e,t=null){return new v(t).shortHash(e)}class B{constructor(e=null,t="USER",s=null,n=null,l=null){this.token=t,this.balance=0,this.molecules={},this.key=null,this.address=null,this.privkey=null,this.pubkey=null,this.bundle=e?T(e):null,this.batchId=n,this.position=s,this.characters="undefined"!==(new M)[l]?l:null,e&&(this.position=this.position||q(),this.prepareKeys(e))}static create(e,t,s=null,n=null){let l=B.isBundleHash(e)?null:e,r=l?T(l):e,i=l?q():null,a=new B(l,t,i,s,n);return a.bundle=r,a}static isBundleHash(e){return"string"==typeof e&&(64===e.length&&$(e))}isShadow(){return!(void 0!==this.position&&null!==this.position||void 0!==this.address&&null!==this.address)}initBatchId(e,t){e.batchId&&(this.batchId=C())}prepareKeys(e){null===this.key&&null===this.address&&(this.key=B.generatePrivateKey(e,this.token,this.position),this.address=B.generatePublicKey(this.key),this.getMyEncPrivateKey(),this.getMyEncPublicKey())}getMyEncPrivateKey(){return null===this.privkey&&null!==this.key&&(this.privkey=R(this.key,this.characters)),this.privkey}getMyEncPublicKey(){const e=this.getMyEncPrivateKey();return!this.pubkey&&e&&(this.pubkey=K(e,this.characters)),this.pubkey}encryptMyMessage(e){const t={};for(let s=1,n=arguments.length;s<n;s++)t[E(arguments[s],this.characters)]=H(e,arguments[s],this.characters);return t}decryptMyMessage(e){const t=this.getMyEncPublicKey();let s=e;return null!==e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&(s=e[E(t,this.characters)]||""),O(s,this.getMyEncPrivateKey(),t,this.characters)}encryptString(e,t){if(e){const s=this.getMyEncPublicKey();"string"==typeof t&&(t=new Array(t));const n=this.encryptMyMessage(e,s,...t);return btoa(JSON.stringify(n))}}decryptString(e,t=null){if(e)try{const s=JSON.parse(atob(e));return this.decryptMyMessage(s)||t}catch(s){return console.error(s),t||e}}static generatePrivateKey(e,s,n){const l=m.default(e,16).add(m.default(n,16)),r=t.shake256.create(8192);return r.update(l.toString(16)),s&&r.update(s),t.shake256.create(8192).update(r.hex()).hex()}static generatePublicKey(e){const s=g(e,128),n=t.shake256.create(8192);for(const e in s){let l=s[e];for(let e=1;e<=16;e++)l=t.shake256.create(512).update(l).hex();n.update(l)}return t.shake256.create(256).update(n.hex()).hex()}}class P extends TypeError{constructor(e=null,t=null,s=null){if(super(e,t,s),null===e)throw new this("Unknown "+this.constructor.name);this.name="BaseException"}toString(){return`${this.name}: ${this.message}.\nStack:\n${this.stack}`}}class j extends P{constructor(e="There is an atom without an index",t=null,s=null){super(e,t,s),this.name="AtomIndexException"}}class U extends P{constructor(e="The molecule does not contain atoms",t=null,s=null){super(e,t,s),this.name="AtomsMissingException"}}class Q extends P{constructor(e="The molecular hash does not match",t=null,s=null){super(e,t,s),this.name="MolecularHashMismatchException"}}class N extends P{constructor(e="The molecular hash is missing",t=null,s=null){super(e,t,s),this.name="MolecularHashMissingException"}}class V extends P{constructor(e="OTS malformed",t=null,s=null){super(e,t,s),this.name="SignatureMalformedException"}}class F extends P{constructor(e="One-time signature (OTS) does not match!",t=null,s=null){super(e,t,s),this.name="SignatureMismatchException"}}class z extends P{constructor(e="Insufficient balance to make transfer",t=null,s=null){super(e,t,s),this.name="TransferBalanceException"}}class J extends P{constructor(e="Token transfer atoms are malformed",t=null,s=null){super(e,t,s),this.name="TransferMalformedException"}}class D extends P{constructor(e="Token slugs for wallets in transfer do not match!",t=null,s=null){super(e,t,s),this.name="TransferMismatchedException"}}class L extends P{constructor(e="Invalid remainder provided",t=null,s=null){super(e,t,s),this.name="TransferRemainderException"}}class G extends P{constructor(e="Sender and recipient(s) cannot be the same",t=null,s=null){super(e,t,s),this.name="TransferToSelfException"}}class X extends P{constructor(e="Token transfer atoms are unbalanced",t=null,s=null){super(e,t,s),this.name="TransferUnbalancedException"}}class Y extends P{constructor(e="Empty meta data.",t=null,s=null){super(e,t,s),this.name="MetaMissingException"}}class Z extends P{constructor(e="Wrong type of token for this isotope",t=null,s=null){super(e,t,s),this.name="WrongTokenTypeException"}}class ee{static continuId(e){ee.missing(e);if("USER"===e.atoms[0].token&&ee.isotopeFilter("I",e.atoms).length<1)throw new U("Missing atom ContinuID");return!0}static isotopeI(e){ee.missing(e);for(let t of ee.isotopeFilter("I",e.atoms)){if("USER"!==t.token)throw new Z(`Invalid token name for "${t.isotope}" isotope`);if(0===t.index)throw new j(`Invalid isotope "${t.isotope}" index`)}return!0}static isotopeU(e){ee.missing(e);for(let t of ee.isotopeFilter("U",e.atoms)){if("AUTH"!==t.token)throw new Z(`Invalid token name for "${t.isotope}" isotope`);if(0!==t.index)throw new j(`Invalid isotope "${t.isotope}" index`)}return!0}static isotopeM(e){ee.missing(e);for(let t of ee.isotopeFilter("M",e.atoms)){if(t.meta.length<1)throw new Y;if("USER"!==t.token)throw new Z(`Invalid token name for "${t.isotope}" isotope`)}return!0}static isotopeC(e){ee.missing(e);for(let t of ee.isotopeFilter("C",e.atoms)){if("USER"!==t.token)throw new Z(`Invalid token name for "${t.isotope}" isotope`);if(0!==t.index)throw new j(`Invalid isotope "${t.isotope}" index`)}return!0}static isotopeT(e){ee.missing(e);for(let t of ee.isotopeFilter("T",e.atoms)){const e=x.aggregateMeta(x.normalizeMeta(t.meta));if("wallet"===String(t.metaType).toLowerCase())for(let t of["position","bundle"])if(!e.hasOwnProperty(t)||!Boolean(e[t]))throw new Y(`No or not defined "${t}" in meta`);for(let t of["token"])if(!e.hasOwnProperty(t)||!Boolean(e[t]))throw new Y(`No or not defined "${t}" in meta`);if("USER"!==t.token)throw new Z(`Invalid token name for "${t.isotope}" isotope`);if(0!==t.index)throw new j(`Invalid isotope "${t.isotope}" index`)}return!0}static isotopeR(e){ee.missing(e);for(let t of ee.isotopeFilter("R",e.atoms)){const e=x.aggregateMeta(x.normalizeMeta(t.meta));for(let t of["callback","conditions","rule"])if(!e.hasOwnProperty(t))throw new Y(`Missing "${t}" field in meta.`);try{const t=JSON.parse(e.conditions);for(let e of t){const t=Object.keys(e),s=t.filter((function(e){return-1!==["key","value","comparison"].indexOf(e)})),n=t.filter((function(e){return-1!==["managedBy"].indexOf(e)}));if(s.length<3&&n.length<1)throw new Y("Missing field in conditions.")}}catch(e){throw new Y("Invalid format for conditions.")}}}static isotopeV(e,t=null){ee.missing(e);const s=ee.isotopeFilter("V",e.atoms);if(0===s.length)return!0;const n=e.atoms[0];if("V"===n.isotope&&2===s.length){const e=s[s.length-1];if(n.token!==e.token)throw new D;if(e.value<0)throw new J;return!0}let l=0,r=0;for(let t in e.atoms)if(e.atoms.hasOwnProperty(t)){const s=e.atoms[t];if("V"!==s.isotope)continue;if(r=1*s.value,Number.isNaN(r))throw new TypeError('Invalid isotope "V" values');if(s.token!==n.token)throw new D;if(t>0){if(r<0)throw new J;if(s.walletAddress===n.walletAddress)throw new G}l+=r}if(l!==r)throw new X;if(t){if(r=1*n.value,Number.isNaN(r))throw new TypeError('Invalid isotope "V" values');const e=1*t.balance+1*r;if(e<0)throw new z;if(e!==l)throw new L}else if(0!==r)throw new L;return!0}static molecularHash(e){if(ee.missing(e),e.molecularHash!==S.hashAtoms(e.atoms))throw new Q;return!0}static ots(e){ee.missing(e);const s=e.atoms[0].walletAddress,n=ee.normalizedHash(e.molecularHash);let l=e.atoms.map((e=>e.otsFragment)).reduce(((e,t)=>e+t));if(2048!==l.length&&(l=_(l),2048!==l.length))throw new V;const r=g(l,128);let i="";for(const e in r){let s=r[e];for(let l=0,r=8+n[e];l<r;l++)s=t.shake256.create(512).update(s).hex();i+=s}const a=t.shake256.create(8192).update(i).hex();if(t.shake256.create(256).update(a).hex()!==s)throw new F;return!0}static index(e){ee.missing(e);for(let t of e.atoms)if(null===t.index)throw new j;return!0}static isotopeFilter(e,t){return(t=t||[]).filter((t=>e===t.isotope))}static normalizedHash(e){return ee.normalize(ee.enumerate(e))}static enumerate(e){const t={0:-8,1:-7,2:-6,3:-5,4:-4,5:-3,6:-2,7:-1,8:0,9:1,a:2,b:3,c:4,d:5,e:6,f:7,g:8},s=[],n=e.toLowerCase().split("");for(let e=0,l=n.length;e<l;++e){const l=n[e];void 0!==t[l]&&(s[e]=t[l])}return s}static normalize(e){let t=e.reduce(((e,t)=>e+t));const s=t<0;for(;t<0||t>0;)for(const n of Object.keys(e)){if((s?e[n]<8:e[n]>-8)&&(s?(++e[n],++t):(--e[n],--t),0===t))break}return e}static missing(e){if(null===e.molecularHash)throw new N;if(1>e.atoms.length)throw new U}}class te extends P{constructor(e="Insufficient balance for requested transfer",t=null,s=null){super(e,t,s),this.name="BalanceInsufficientException"}}class se extends P{constructor(e="Amount cannot be negative!",t=null,s=null){super(e,t,s),this.name="NegativeAmountException"}}const ne=require("lodash.clonedeep"),le=require("lodash.merge");class re{constructor(e=null){this.cellSlugOrigin=this.cellSlug=e}get cellSlugDelimiter(){return"."}cellSlugBase(){return(this.cellSlug||"").split(this.cellSlugDelimiter)[0]}toJSON(){let e=ne(this);for(let t of["remainderWallet","secret","sourceWallet","cellSlugOrigin"])e.hasOwnProperty(t)&&delete e[t];return e}check(e=null){return re.verify(this,e)}static verify(e,t=null){return ee.molecularHash(e)&&ee.ots(e)&&ee.index(e)&&ee.continuId(e)&&ee.isotopeM(e)&&ee.isotopeT(e)&&ee.isotopeC(e)&&ee.isotopeU(e)&&ee.isotopeI(e)&&ee.isotopeV(e,t)}static jsonToObject(e){const t=le(new this,JSON.parse(e)),s=Object.keys(new this);if(!Array.isArray(t.atoms))throw new U;for(const e in Object.keys(t.atoms)){t.atoms[e]=S.jsonToObject(JSON.stringify(t.atoms[e]));for(const s of["position","walletAddress","isotope"])if(void 0===t.atoms[e][s]||null===t.atoms[e][s])throw new U("The required properties of the atom are not filled.")}for(const e in t)t.hasOwnProperty(e)&&!s.includes(e)&&delete t[e];return t.atoms=S.sortAtoms(t.atoms),t}}const ie=require("lodash.merge");class ae extends re{constructor(e,t=null,s=null,n=null){super(n),this.secret=e,this.sourceWallet=t,this.atoms=[],(s||t)&&(this.remainderWallet=s||B.create(e,t.token,t.batchId,t.characters)),this.clear()}static mergeMetas(e,t={}){return ie(e||{},t)}static verify(e,t=null){return ee.molecularHash(e)&&ee.ots(e)&&ee.index(e)&&ee.continuId(e)&&ee.isotopeM(e)&&ee.isotopeT(e)&&ee.isotopeC(e)&&ee.isotopeU(e)&&ee.isotopeI(e)&&ee.isotopeR(e)&&ee.isotopeV(e,t)}static generateNextAtomIndex(e){const t=e.length-1;return t>-1?e[t].index+1:0}continuIdMetaType(){return"walletBundle"}fill(e){for(let t in Object.keys(e))this[t]=e[t]}addAtom(e){return this.molecularHash=null,this.atoms.push(e),this.atoms=S.sortAtoms(this.atoms),this}replenishTokens(e,t,s){const n=x.aggregateMeta(x.normalizeMeta(s));n.action="add";for(let e of["address","position","batchId"])if(void 0===n[e])throw new Y(`Missing ${e} in meta`);return this.molecularHash=null,this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"C",this.sourceWallet.token,e,this.sourceWallet.batchId,"token",t,ae.mergeMetas({pubkey:this.sourceWallet.pubkey,characters:this.sourceWallet.characters},n),null,this.generateIndex())),this.addUserRemainderAtom(this.remainderWallet),this.atoms=S.sortAtoms(this.atoms),this}addUserRemainderAtom(e){return this.molecularHash=null,this.atoms.push(new S(e.position,e.address,"I",e.token,null,null,"walletBundle",e.bundle,{pubkey:e.pubkey,characters:e.characters},null,this.generateIndex())),this.atoms=S.sortAtoms(this.atoms),this}burnTokens(e,t=null){if(e<0)throw new se("Amount to burn must be positive!");if(this.sourceWallet.balance-e<0)throw new te;return this.molecularHash=null,this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"V",this.sourceWallet.token,-e,this.sourceWallet.batchId,null,null,{pubkey:this.sourceWallet.pubkey,characters:this.sourceWallet.characters},null,this.generateIndex())),this.atoms.push(new S(this.remainderWallet.position,this.remainderWallet.address,"V",this.sourceWallet.token,this.sourceWallet.balance-e,this.remainderWallet.batchId,t?"walletBundle":null,t,{pubkey:this.remainderWallet.pubkey,characters:this.remainderWallet.characters},null,this.generateIndex())),this.atoms=S.sortAtoms(this.atoms),this}initValue(e,t){if(this.sourceWallet.balance-t<0)throw new te;return this.molecularHash=null,this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"V",this.sourceWallet.token,-t,this.sourceWallet.batchId,null,null,{pubkey:this.sourceWallet.pubkey,characters:this.sourceWallet.characters},null,this.generateIndex())),this.atoms.push(new S(e.position,e.address,"V",this.sourceWallet.token,t,e.batchId,"walletBundle",e.bundle,{pubkey:e.pubkey,characters:e.characters},null,this.generateIndex())),this.atoms.push(new S(this.remainderWallet.position,this.remainderWallet.address,"V",this.sourceWallet.token,this.sourceWallet.balance-t,this.remainderWallet.batchId,"walletBundle",this.sourceWallet.bundle,{pubkey:this.remainderWallet.pubkey,characters:this.remainderWallet.characters},null,this.generateIndex())),this.atoms=S.sortAtoms(this.atoms),this}initWalletCreation(e){this.molecularHash=null;const t={address:e.address,token:e.token,bundle:e.bundle,position:e.position,amount:0,batch_id:e.batchId,pubkey:e.pubkey,characters:e.characters};return this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"C",this.sourceWallet.token,null,this.sourceWallet.batchId,"wallet",e.address,t,null,this.generateIndex())),this.addUserRemainderAtom(this.remainderWallet),this.atoms=S.sortAtoms(this.atoms),this}initIdentifierCreation(e,t,s){return this.molecularHash=null,this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"C",this.sourceWallet.token,null,null,"identifier",e,{pubkey:this.sourceWallet.pubkey,characters:this.sourceWallet.characters,code:s,hash:T(t.trim())},null,this.generateIndex())),this.addUserRemainderAtom(this.remainderWallet),this.atoms=S.sortAtoms(this.atoms),this}initTokenCreation(e,t,s){this.molecularHash=null;for(const t of["walletAddress","walletPosition","walletPubkey","walletCharacters"])s[t]||(s[t]=e[t.toLowerCase().substr(6)]);return s.pubkey=this.sourceWallet.pubkey,s.characters=this.sourceWallet.characters,this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"C",this.sourceWallet.token,t,e.batchId,"token",e.token,s,null,this.generateIndex())),this.addUserRemainderAtom(this.remainderWallet),this.atoms=S.sortAtoms(this.atoms),this}crateRule(e,t,s){const n=x.aggregateMeta(x.normalizeMeta(s));for(let e of["conditions","callback","rule"]){if(void 0===n[e])throw new Y(`No or not defined ${e} in meta`);for(let t of["[object Object]","[object Array]"])Object.prototype.toString.call(n[e])===t&&(n[e]=JSON.stringify(n[e]))}return n.pubkey=this.sourceWallet.pubkey,n.characters=this.sourceWallet.characters,this.addAtom(new S(this.sourceWallet.position,this.sourceWallet.address,"R",this.sourceWallet.token,null,null,e,t,n,null,this.generateIndex())),this.addUserRemainderAtom(this.remainderWallet),this.atoms=S.sortAtoms(this.atoms),this}initShadowWalletClaim(e,t){this.molecularHash=null;let s={tokenSlug:e,walletAddress:t.address,walletPosition:t.position,batchId:t.batchId};return this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"C",this.sourceWallet.token,null,null,"wallet",t.address,ae.mergeMetas({pubkey:this.sourceWallet.pubkey,characters:this.sourceWallet.characters},s),null,this.generateIndex())),this.addUserRemainderAtom(this.remainderWallet),this.atoms=S.sortAtoms(this.atoms),this}initMeta(e,t,s){this.molecularHash=null;const n={};return this.sourceWallet.pubkey&&(n.pubkey=this.sourceWallet.pubkey),this.sourceWallet.characters&&(n.characters=this.sourceWallet.characters),this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"M",this.sourceWallet.token,null,this.sourceWallet.batchId,t,s,ae.mergeMetas(n,e),null,this.generateIndex())),this.addUserRemainderAtom(this.remainderWallet),this.atoms=S.sortAtoms(this.atoms),this}initTokenRequest(e,t,s,n,l={}){return this.molecularHash=null,this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"T",this.sourceWallet.token,t,null,s,n,ae.mergeMetas({pubkey:this.sourceWallet.pubkey,characters:this.sourceWallet.characters,token:e},l),null,this.generateIndex())),this.addUserRemainderAtom(this.remainderWallet),this.atoms=S.sortAtoms(this.atoms),this}initAuthorization(){return this.molecularHash=null,this.atoms.push(new S(this.sourceWallet.position,this.sourceWallet.address,"U",this.sourceWallet.token,null,this.sourceWallet.batchId,null,null,{pubkey:this.sourceWallet.pubkey,characters:this.sourceWallet.characters},null,this.generateIndex())),this.atoms=S.sortAtoms(this.atoms),this}clear(){return this.molecularHash=null,this.bundle=null,this.status=null,this.createdAt=String(+new Date),this.atoms=[],this}sign(e=!1,s=!0){if(0===this.atoms.length||0!==this.atoms.filter((e=>!(e instanceof S))).length)throw new U;e||(this.bundle=T(this.secret)),this.molecularHash=S.hashAtoms(this.atoms);const n=this.atoms[0],l=g(B.generatePrivateKey(this.secret,n.token,n.position),128),r=ee.normalizedHash(this.molecularHash);let i="";for(const e in l){let s=l[e];for(let n=0,l=8-r[e];n<l;n++)s=t.shake256.create(512).update(s).hex();i+=s}s&&(i=b(i));const a=g(i,Math.ceil(i.length/this.atoms.length));let o=null;for(let e=0,t=a.length;e<t;e++)this.atoms[e].otsFragment=a[e],o=this.atoms[e].position;return o}check(e=null){return ae.verify(this,e)}generateIndex(){return ae.generateNextAtomIndex(this.atoms)}}class oe{static __init(e,t){this.arr=[],this.key=null,this.arr=String(t).split("."),this.key=this.arr.shift();const s=Number(this.key);Number.isInteger(s)&&(this.key=s),this.__nextKey=this.arr.length,this.__next=this.__tic(e)}static __tic(e){return!!(Array.isArray(e)||e instanceof Object)&&void 0!==e[this.key]}static has(e,t){return this.__init(e,t),!!this.__next&&(0===this.__nextKey||this.has(e[this.key],this.arr.join(".")))}static get(e,t,s=null){return this.__init(e,t),this.__next?0===this.__nextKey?e[this.key]:this.get(e[this.key],this.arr.join("."),s):s}}const ue=require("lodash.merge");class ce{constructor(e,t={}){this.$__headers=new c.Headers(t.headers||{}),this.$__needHeaders={accept:"application/json","content-type":"application/json; charset=UTF-8"},this.$__config=ue(t,{method:"POST",headers:this.$__headers}),this.setUrl(e)}getConfig(){return this.$__config}setUrl(e){this.$__url=e}getUrl(){return this.$__url}setAuthToken(e){this.$__headers.set("X-Auth-Token",e||"")}getAuthToken(){return this.$__headers.get("X-Auth-Token")||""}async send(e,t={}){e.headers.extend(t),this.$__headers.extend(e.headers.asObject());for(let e in this.$__needHeaders)this.$__headers.set(e,this.$__needHeaders[e]);this.setAuthToken(this.getAuthToken());const s=new c.Request(e,this.$__config);return s.headers.delete("content-length"),await h.fetch(s)}}class he extends P{constructor(e="GraphQL did not provide a valid response.",t=null,s=null){super(e,t,s),this.name="InvalidResponseException"}}class de extends P{constructor(e="Authorization token missing or invalid.",t=null,s=null){super(e,t,s),this.name="UnauthenticatedException"}}class pe{constructor(e,t){if(this.dataKey=null,this.errorKey="exception",this.$__payload=null,this.$__query=e,this.$__originResponse=t,this.$__response=t,void 0===this.$__response||null===this.$__response)throw new he;if(oe.has(this.$__response,this.errorKey)){const e=oe.get(this.$__response,this.errorKey);if(String(e).includes("Unauthenticated"))throw new de;throw new he}this.init()}data(){if(!this.dataKey)return this.response();if(!oe.has(this.response(),this.dataKey))throw new he;return oe.get(this.response(),this.dataKey)}response(){return this.$__response}payload(){return null}query(){return this.$__query}init(){return null}}class me{constructor(e){this.client=e,this.$__fields=null,this.$__variables=null,this.$__request=null,this.$__response=null,this.$__query=null}request(){return this.$__request}response(){return this.$__response}createRequest(e=null,t=null){return this.$__variables=this.compiledVariables(e),new c.Request(this.url(),{body:JSON.stringify({query:this.compiledQuery(t),variables:this.variables()})})}compiledVariables(e=null){return e||{}}compiledQuery(e=null){return null!==e&&(this.$__fields=e),this.$__query.replace(new RegExp("@fields","g"),this.compiledFields(this.$__fields))}compiledFields(e){const t=[];for(let s of Object.keys(e))t.push(e[s]?`${s} ${this.compiledFields(e[s])}`:`${s}`);return`{ ${t.join(", ")} }`}async execute(e=null,t=null){this.$__request=this.createRequest(e,t);let s=await this.client.send(this.$__request);return this.$__response=await this.createResponseRaw(s),this.$__response}async createResponseRaw(e){return this.createResponse(JSON.parse(await e.text()))}createResponse(e){return new pe(this,e)}url(){return this.client.getUrl()}variables(){return this.$__variables}}class ye extends pe{constructor(e,t){super(e,t),this.dataKey="data.ContinuId",this.init()}payload(){let e=null;const t=this.data();return t&&(e=new B(null,t.tokenSlug),e.address=t.address,e.position=t.position,e.bundle=t.bundleHash,e.batchId=t.batchId,e.characters=t.characters,e.pubkey=t.pubkey,e.balance=1*t.amount),e}}class fe extends me{constructor(e){super(e),this.$__query="query ($bundle: String!) { ContinuId(bundle: $bundle) @fields }",this.$__fields={address:null,bundleHash:null,tokenSlug:null,position:null,batchId:null,characters:null,pubkey:null,amount:null,createdAt:null}}createResponse(e){return new ye(this,e)}}class ge extends pe{constructor(e,t){super(e,t),this.dataKey="data.WalletBundle",this.init()}payload(){const e=this.data();if(!e||0===e.length)return null;const t={};return e.forEach((e=>{e.metas=x.aggregateMeta(e.metas),t[e.bundleHash]=e})),t}}class we extends me{constructor(e){super(e),this.$__query="query( $bundleHash: String, $bundleHashes: [ String! ], $key: String, $keys: [ String! ], $value: String, $values: [ String! ], $keys_values: [ MetaInput ], $latest: Boolean, $limit: Int, $order: String ) { WalletBundle( bundleHash: $bundleHash, bundleHashes: $bundleHashes, key: $key, keys: $keys, value: $value, values: $values, keys_values: $keys_values, latest: $latest, limit: $limit, order: $order ) @fields }",this.$__fields={bundleHash:null,metas:{molecularHash:null,position:null,key:null,value:null,createdAt:null},createdAt:null}}createResponse(e){return new ge(this,e)}static createVariables(e=null,t=null,s=null,n=!0){const l={latest:n};return e&&(l["string"==typeof e?"bundleHash":"bundleHashes"]=e),t&&(l["string"==typeof t?"key":"keys"]=t),s&&(l["string"==typeof s?"value":"values"]=s),l}}class ke extends pe{constructor(e,t){super(e,t),this.dataKey="data.Wallet",this.init()}static toClientWallet(e,t=null){let s;return null===e.position||void 0===e.position?s=B.create(e.bundleHash,e.tokenSlug,e.batchId,e.characters):(s=new B(t,e.tokenSlug,e.position,e.batchId,e.characters),s.address=e.address,s.bundle=e.bundleHash),e.token&&(s.tokenName=e.token.name,s.tokenSupply=e.token.amount),s.molecules=e.molecules,s.balance=Number(e.amount),s.pubkey=e.pubkey,s.createdAt=e.createdAt,s}getWallets(e){const t=this.data();if(!t)return null;const s=[];for(let n of t)s.push(ke.toClientWallet(n,e));return s}payload(){const e=this.data();if(!e)return null;const t=[];for(let s of e)t.push(ke.toClientWallet(s));return t}}class be extends me{constructor(e){super(e),this.$__query="query( $address: String, $bundleHash: String, $token: String, $position: String, $unspent: Boolean ) { Wallet( address: $address, bundleHash: $bundleHash, token: $token, position: $position, unspent: $unspent ) @fields }",this.$__fields={address:null,bundleHash:null,token:{name:null,amount:null},molecules:{molecularHash:null,createdAt:null},tokenSlug:null,batchId:null,position:null,amount:null,characters:null,pubkey:null,createdAt:null}}createResponse(e){return new ke(this,e)}}class _e extends pe{constructor(e,t){super(e,t),this.dataKey="data.Balance",this.init()}payload(){const e=this.data();return e&&e.bundleHash&&e.tokenSlug?ke.toClientWallet(e):null}}class $e extends me{constructor(e){super(e),this.$__query="query( $address: String, $bundleHash: String, $token: String, $position: String ) { Balance( address: $address, bundleHash: $bundleHash, token: $token, position: $position ) @fields }",this.$__fields={address:null,bundleHash:null,tokenSlug:null,batchId:null,position:null,amount:null,characters:null,pubkey:null,createdAt:null}}createResponse(e){return new _e(this,e)}}class xe extends pe{constructor(e,t){super(e,t),this.dataKey="data.MetaType",this.init()}payload(){const e=this.data();if(!e||0===e.length)return null;let t=e.pop(),s=t.instances;return t.instanceCount&&(s.instanceCount=t.instanceCount),t.paginatorInfo&&(s.paginatorInfo=t.paginatorInfo),s}}class Se extends me{constructor(e){super(e),this.$__query="query( $metaType: String, $metaTypes: [ String! ], $metaId: String, $metaIds: [ String! ], $key: String, $keys: [ String! ], $value: String, $values: [ String! ], $count: String, $latest: Boolean, $filter: [ MetaFilter! ], $latestMetas: Boolean, $queryArgs: QueryArgs ) { MetaType( metaType: $metaType, metaTypes: $metaTypes, metaId: $metaId, metaIds: $metaIds, key: $key, keys: $keys, value: $value, values: $values, count: $count, filter: $filter, latestMetas: $latestMetas, queryArgs: $queryArgs ) @fields }",this.$__fields={metaType:null,instanceCount:{key:null,value:null},instances:{metaType:null,metaId:null,createdAt:null,"metas(latest:$latest)":{molecularHash:null,position:null,key:null,value:null,createdAt:null}},paginatorInfo:{currentPage:null,lastPage:null}}}createResponse(e){return new xe(this,e)}static createVariables(e=null,t=null,s=null,n=null,l=null,r=null,i=!0,a={},o=null){const u={};return e&&(u["string"==typeof e?"metaType":"metaTypes"]=e),t&&(u["string"==typeof t?"metaId":"metaIds"]=t),s&&(u["string"==typeof s?"key":"keys"]=s),n&&(u["string"==typeof n?"value":"values"]=n),l&&(u.latest=!!l),i&&(u.latestMetas=!!i),r&&(u.filter=r),a&&(u.queryArgs=a),o&&(u.count=o),u}}class Me extends pe{constructor(e,t){super(e,t),this.dataKey="data.ProposeMolecule",this.$__clientMolecule=e.molecule(),this.init()}init(){const e=oe.get(this.data(),"payload");try{this.$__payload=JSON.parse(e)}catch(e){this.$__payload=null}}clientMolecule(){return this.$__clientMolecule}molecule(){const e=this.data();if(!e)return null;const t=new re;return t.molecularHash=oe.get(e,"molecularHash"),t.status=oe.get(e,"status"),t.status=oe.get(e,"createdAt"),t}success(){return"accepted"===this.status()}status(){return oe.get(this.data(),"status","rejected")}reason(){return oe.get(this.data(),"reason","Invalid response from server")}payload(){return this.$__payload}}class We extends me{}const Ie=require("lodash.merge");class ve extends We{constructor(e,t=null){super(e),this.$__molecule=t,this.$__remainderWallet=null,this.$__query="mutation( $molecule: MoleculeInput! ) { ProposeMolecule( molecule: $molecule ) @fields }",this.$__fields={molecularHash:null,height:null,depth:null,status:null,reason:null,payload:null,createdAt:null,receivedAt:null,processedAt:null,broadcastedAt:null}}compiledVariables(e){const t=super.compiledVariables(e);return Ie(t,{molecule:this.molecule()})}createResponse(e){return new Me(this,e)}async execute(e=null,t=null){return await super.execute(Ie(e||{},{molecule:this.molecule()}),t)}remainderWallet(){return this.$__remainderWallet}molecule(){return this.$__molecule}}class Ae extends Me{payloadKey(e){if(!oe.has(this.payload(),e))throw new he(`ResponseAuthorization: '${e}' key is not found in the payload.`);return oe.get(this.payload(),e)}token(){return this.payloadKey("token")}time(){return this.payloadKey("time")}}class Te extends ve{fillMolecule(){this.$__molecule.initAuthorization(),this.$__molecule.sign(),this.$__molecule.check()}createResponse(e){return new Ae(this,e)}}class Ce extends Me{}class qe extends ve{fillMolecule(e,t,s=null){this.$__molecule.initTokenCreation(e,t,s||{}),this.$__molecule.sign(),this.$__molecule.check()}createResponse(e){return new Ce(this,e)}}class He extends ve{fillMolecule(e,t,s,n,l=null){this.$__molecule.initTokenRequest(e,t,s,n,l||{}),this.$__molecule.sign(),this.$__molecule.check()}}class Oe extends Me{payload(){const e={reason:null,status:null},t=this.data();return e.reason=void 0===t.reason?"Invalid response from server":t.reason,e.status=void 0===t.status?"rejected":t.status,e}}class Re extends ve{fillMolecule(e,t){this.$__molecule.initValue(e,t),this.$__molecule.sign(),this.$__molecule.check(this.$__molecule.sourceWallet)}createResponse(e){return new Oe(this,e)}}class Ke extends ve{fillMolecule(e,t,s){this.$__molecule.initIdentifierCreation(e,t,s),this.$__molecule.sign(),this.$__molecule.check()}}class Ee extends ve{fillMolecule(e,t){let s=B.create(this.$__molecule.secret,e,t);this.$__molecule.initShadowWalletClaim(e,s),this.$__molecule.sign(),this.$__molecule.check()}}class Be extends P{constructor(e="Code exception",t=null,s=null){super(e,t,s),this.name="CodeException"}}class Pe extends P{constructor(e="The shadow wallet does not exist",t=null,s=null){super(e,t,s),this.name="WalletShadowException"}}class je extends Me{}class Ue extends ve{fillMolecule(e,t,s){this.$__molecule.initMeta(s,e,t),this.$__molecule.sign(),this.$__molecule.check()}createResponse(e){return new je(this,e)}}class Qe extends ve{fillMolecule(e){this.$__molecule.initWalletCreation(e),this.$__molecule.sign(),this.$__molecule.check()}}class Ne{constructor(e,t=null,s=3){this.initialize(e,t,s)}initialize(e,t=null,s=3){console.info(`KnishIOClient::initialize() - Initializing new Knish.IO client session for SDK version ${s}...`),this.reset(),this.$__client=t||new ce(e),this.$__serverSdkVersion=s}deinitialize(){console.info("KnishIOClient::deinitialize() - Clearing the Knish.IO client session..."),this.reset()}getServerSdkVersion(){return this.$__serverSdkVersion}reset(){this.$__secret="",this.$__bundle="",this.remainderWallet=null}cellSlug(){return this.$__cellSlug||null}setCellSlug(e){this.$__cellSlug=e}url(){return this.client().getUrl()}client(){return this.$__client}hasSecret(){return!!this.$__secret}setSecret(e){this.$__secret=e,this.$__bundle=T(e)}secret(){if(!this.$__secret)throw new de("KnishIOClient::secret() - Unable to find a stored secret!");return this.$__secret}bundle(){if(!this.$__bundle)throw new de("KnishIOClient::bundle() - Unable to find a stored bundle!");return this.$__bundle}async getSourceWallet(){let e=(await this.queryContinuId(this.bundle())).payload();return e||(e=new B(this.secret())),e}getRemainderWallet(){return this.remainderWallet}async createMolecule(e=null,t=null,s=null){console.info("KnishIOClient::createMolecule() - Creating a new molecule...");const n=e||this.secret();let l=t;return!t&&this.lastMoleculeQuery&&"AUTH"!==this.getRemainderWallet().token&&this.lastMoleculeQuery&&this.lastMoleculeQuery.response()&&this.lastMoleculeQuery.response().success()&&(l=this.getRemainderWallet()),null===l&&(l=await this.getSourceWallet()),this.remainderWallet=s||B.create(n,l.token,l.batchId,l.characters),new ae(n,l,this.getRemainderWallet(),this.cellSlug())}createQuery(e){return new e(this.client())}async createMoleculeMutation(e,t=null){console.info(`KnishIOClient::createMoleculeQuery() - Creating a new ${e.name} query...`);let s=t||await this.createMolecule();const n=new e(this.client(),s);if(!(n instanceof ve))throw new Be(`${this.constructor.name}::createMoleculeMutation - required class instance of MutationProposeMolecule.`);return this.lastMoleculeQuery=n,n}async requestAuthToken(e,t=null){if(console.info("KnishIOClient::requestAuthToken() - Requesting authorization token..."),this.setSecret(e),this.$__cellSlug=t||this.cellSlug(),this.$__serverSdkVersion>2){let e=await this.createMolecule(this.secret(),new B(this.secret(),"AUTH"));const t=await this.createMoleculeMutation(Te,e);t.fillMolecule();const s=await t.execute();if(!s.success())throw console.warn("KnishIOClient::requestAuthToken() - Unable to retrieve auth token..."),new de(s.reason());{const e=s.token();this.client().setAuthToken(e),console.info(`KnishIOClient::requestAuthToken() - Successfully retrieved auth token ${s.token()}...`)}return s}console.warn("KnishIOClient::requestAuthToken() - Server SDK version does not require an auth token...")}async queryBalance(e,t=null){const s=this.createQuery($e);return await s.execute({bundleHash:t||this.bundle(),token:e})}queryMeta(e,t=null,s=null,n=null,l=null,r=null,i=null,a={},o=null){console.info(`KnishIOClient::queryMeta() - Querying meta type data for metaType: ${e}, metaId: ${t}, key: ${s}, value: ${n}, latest: ${l}...`);const u=this.createQuery(Se),c=Se.createVariables(e,t,s,n,l,i,!0,a,o);return u.execute(c,r).then((e=>e.payload()))}async createWallet(e){const t=new B(this.secret(),e),s=await this.createMoleculeMutation(Qe);return s.fillMolecule(t),await s.execute()}async createToken(e,t,s=null){const n=new B(this.secret(),e);"stackable"===oe.get(s||{},"fungibility")&&(n.batchId=C());const l=await this.createMoleculeMutation(qe);return l.fillMolecule(n,t,s||{}),await l.execute()}async createMeta(e,t,s=null){const n=await this.createMoleculeMutation(Ue,await this.createMolecule(this.secret(),await this.getSourceWallet()));return n.fillMolecule(e,t,s),await n.execute()}async createIdentifier(e,t,s){const n=await this.createMoleculeMutation(Ke);return n.fillMolecule(e,t,s),await n.execute()}queryWallets(e=null,t=!0){console.info(`KnishIOClient::queryWallets() - Querying wallets${e?` for ${e}`:""}...`);return this.createQuery(be).execute({bundleHash:e||this.bundle(),unspent:t}).then((e=>e.getWallets()))}queryShadowWallets(e="KNISH",t=null){t=t||this.bundle(),console.info(`KnishIOClient::queryShadowWallets() - Querying ${e} shadow wallets for ${t}...`);return this.createQuery(be).execute({bundleHash:t,token:e}).then((e=>e.payload()))}queryBundle(e=null,t=null,s=null,n=!0,l=null){console.info(`KnishIOClient::queryBundle() - Querying wallet bundle metadata${e?` for ${e}`:""}...`);const r=this.createQuery(we),i=we.createVariables(null!==e?e:this.bundle(),t,s,n);return r.execute(i,l).then((e=>e.payload()))}async queryContinuId(e){return await this.createQuery(fe).execute({bundle:e})}async requestTokens(e,t,s,n=null){let l,r;s?("[object String]"===Object.prototype.toString.call(s)&&(B.isBundleHash(s)?(l="walletBundle",r=s):s=B.create(s,e)),s instanceof B&&(l="wallet",n=ae.mergeMetas(n||{},{position:s.position,bundle:s.bundle}),r=s.address)):(l="walletBundle",r=this.bundle());const i=await this.createMoleculeMutation(He);return i.fillMolecule(e,t,l,r,n),await i.execute()}async claimShadowWallet(e,t,s=null){const n=await this.createMoleculeMutation(Ee,s);return n.fillMolecule(e,t),await n.execute()}async claimShadowWallets(e){const t=await this.queryShadowWallets(e);if(!t||!Array.isArray(t))throw new Pe;t.forEach((e=>{if(!e.isShadow())throw new Pe}));let s=[];for(const n of t)s.push(await this.claimShadowWallet(e,n.batchId));return s}async transferToken(e,t,s){const n=(await this.queryBalance(t)).payload();if(null===n||I.cmp(n.balance,s)<0)throw new z;let l=e instanceof B?e:(await this.queryBalance(t,e)).payload();null===l&&(l=B.create(e,t)),l.initBatchId(n,s),this.remainderWallet=B.create(this.secret(),t,l.batchId,n.characters);const r=await this.createMolecule(null,n,B.create(this.secret(),t,l.batchId,n.characters)),i=await this.createMoleculeMutation(Re,r);return i.fillMolecule(l,s),await i.execute()}}return e.Atom=S,e.KnishIOClient=Ne,e.Meta=x,e.Molecule=ae,e.Test=class{constructor(e){this.secrets=[A(),A()],this.tokenSlugs=["TESTTOKEN","UTENVSTACKABLE"],this.graphqlUrl=e,this.clients={}}async testAll(){await this.client(this.secrets[0]),await this.client(this.secrets[1]),await this.testCreateToken(),await this.testCreateWallet(),await this.testCreateMeta(),await this.testCreateIdentifier(),await this.testRequestTokens(),await this.testTransferToken(),await this.testClaimShadowWallet(),await this.testQueryMeta(),await this.testQueryWallets(),await this.testQueryShadowWallets(),await this.testQueryBundle(),await this.testQueryBalance()}testCreateToken(){let e=this.tokenSlugs[0];return this.client(this.secrets[0]).createToken(e,1e3,{name:e,fungibility:"stackable",supply:"limited",decimals:0,icon:"icon"}).then((e=>{this.checkResponse(e,"testCreateToken")}))}testCreateWallet(){return this.client(this.secrets[0]).createWallet(this.tokenSlugs[1]).then((e=>{this.checkResponse(e,"testCreateWallet")}))}testCreateMeta(){return this.client(this.secrets[0]).createMeta("metaType","metaId",{key1:"value1",key2:"value2"}).then((e=>{this.checkResponse(e,"testCreateMeta")}))}testCreateIdentifier(){return this.client(this.secrets[0]).createIdentifier("email","test@test.com",1234).then((e=>{this.checkResponse(e,"testCreateIdentifier")}))}testRequestTokens(){return this.client(this.secrets[0]).requestTokens(this.tokenSlugs[1],10,this.secrets[0]).then((e=>{this.checkResponse(e,"testRequestTokens")}))}testTransferToken(){let e=T(this.secrets[1]);return this.client(this.secrets[0]).transferToken(e,this.tokenSlugs[0],10).then((e=>{this.checkResponse(e,"testTransferToken")}))}testClaimShadowWallet(){return this.client(this.secrets[1]).claimShadowWallet(this.tokenSlugs[0]).then((e=>{this.checkResponse(e,"testClaimShadowWallet")}))}testQueryMeta(){return this.client(this.secrets[0]).queryMeta("metaType","metaId").then((e=>{this.checkResponse(e,"testQueryMeta")}))}testQueryWallets(){return this.client(this.secrets[0]).queryWallets().then((e=>{this.checkResponse(e,"testQueryWallets")}))}testQueryShadowWallets(){return this.client(this.secrets[1]).queryShadowWallets(this.tokenSlugs[0]).then((e=>{this.checkResponse(e,"testQueryShadowWallets")}))}testQueryBundle(){return this.client(this.secrets[0]).queryBundle().then((e=>{this.checkResponse(e,"testQueryBundle")}))}testQueryContinuId(){let e=T(this.secrets[0]);return this.client(this.secrets[0]).queryContinuId(e).then((e=>{this.checkResponse(e,"testQueryContinuId")}))}testQueryBalance(){return this.client(this.secrets[0]).queryBalance(this.tokenSlugs[0]).then((e=>{this.checkResponse(e,"testQueryBalance")}))}client(e,t="unit_test"){return this.clients[e]?this.clients[e]:(this.clients[e]=new Ne(this.graphqlUrl),this.clients[e].requestAuthToken(e,t).then((e=>{this.checkResponse(e,"requestAuthToken")})))}checkResponse(e,t){console.log(" ############### "+t+" ###############"),console.log(e),e instanceof Me?(e.success()||this.debug(e),console.assert("accepted"==e.status(),e)):this.debug(e)}debug(e){e.data&&oe.get(e.data()||{},"reason")?console.log(e.data().reason):console.log(e)}},e.Wallet=B,e.base64ToHex=_,e.bufferToHexString=function(e){return f.toHex(e,{})},e.charsetBaseConvert=k,e.chunkSubstr=g,e.decryptMessage=O,e.encryptMessage=H,e.generateBundleHash=T,e.generateEncPrivateKey=R,e.generateEncPublicKey=K,e.generateSecret=A,e.hashShare=E,e.hexStringToBuffer=function(e){return f.toUint8Array(e)},e.hexToBase64=b,e.isHex=$,e.randomString=w,Object.defineProperty(e,"__esModule",{value:!0}),e}({},jsSha3,bigInt,base64,bigIntB,baseX,buffer,tweetnacl,tweetnaclSealedboxJs,utf8,servie,popsicle);
